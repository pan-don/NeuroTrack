<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="NeuroTrack Doctor Dashboard">
    <title>Doctor Dashboard | NeuroTrack</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/dashboard.css">
</head>
<body>
    <!-- Header Navigation -->
    <header class="dashboard-header">
        <div class="header-container">
            <!-- Logo -->
            <a href="#" class="header-logo">
                <img src="../assets/img/logo.png" alt="NeuroTrack Logo" class="header-logo__image">
            </a>

            <!-- Navigation Links -->
            <nav class="header-nav">
                <a href="#" class="header-nav__link" onclick="showSection('dashboard'); return false;">Dashboard</a>
                <a href="#" class="header-nav__link" onclick="showSection('schedule'); return false;">Schedule</a>
                <a href="#" class="header-nav__link" onclick="showSection('profile'); return false;">Profile</a>
                <a href="#" class="header-nav__link" onclick="showSection('messages'); return false;">Messages</a>
            </nav>

            <!-- Actions -->
            <div class="header-actions">
                <!-- Notification Bell - Filled Icon -->
                <div style="position: relative;">
                    <button class="header-notification" aria-label="Notifications" title="Notifications" onclick="toggleNotifications()">
                        <svg class="notification-icon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"/>
                        </svg>
                        <span class="header-notification__badge"></span>
                    </button>
                    
                    <!-- Notification Dropdown -->
                    <div class="notification-dropdown" id="notificationDropdown">
                        <div class="notification-dropdown__header">
                            <span class="notification-dropdown__title">Notifications</span>
                            <span class="notification-dropdown__count">6</span>
                        </div>
                        <div class="notification-dropdown__list" id="notificationList">
                            <!-- Notifications will be inserted here by JavaScript -->
                        </div>
                        <div class="notification-dropdown__footer">
                            <a href="#">View all notifications</a>
                        </div>
                    </div>
                </div>

                <!-- User Profile - Round Photo -->
                <div class="header-user" onclick="toggleUserMenu()">
                    <div class="header-user__info">
                        <div class="header-user__name" id="userName">Dr. Dokter</div>
                        <div class="header-user__role" id="userRole">Doctor</div>
                    </div>
                    <div class="header-user__avatar" id="userAvatar">
                        <!-- Profile photo will be inserted here or show initial -->
                        D
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Doctor Profile Modal -->
    <div class="profile-modal" id="profileModal">
        <div class="profile-modal__overlay" onclick="closeProfileModal()"></div>
        <div class="profile-modal__panel">
            <div class="profile-modal__header">
                <h2 class="profile-modal__title">Doctor Profile</h2>
                <button class="profile-modal__close" onclick="closeProfileModal()" aria-label="Close profile">
                    <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <div class="profile-modal__content">
                <!-- Profile Photo Section -->
                <div class="profile-photo-section">
                    <div class="profile-photo-wrapper">
                        <div class="profile-photo" id="profilePhoto">
                            <span id="profilePhotoInitial">D</span>
                        </div>
                        <div class="profile-photo-status"></div>
                    </div>
                    <h3 class="profile-name" id="profileName">Dr. Dokter</h3>
                    <p class="profile-role-badge" id="profileRoleBadge">Doctor</p>
                </div>

                <!-- Profile Information Cards -->
                <div class="profile-info-section">
                    <h4 class="profile-section-title">Personal Information</h4>
                    
                    <div class="profile-info-card">
                        <div class="profile-info-item">
                            <div class="profile-info-icon">
                                <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
                                    <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
                                </svg>
                            </div>
                            <div class="profile-info-content">
                                <span class="profile-info-label">Email Address</span>
                                <span class="profile-info-value" id="profileEmail">dokter@neurotrack.com</span>
                            </div>
                        </div>
                    </div>

                    <div class="profile-info-card">
                        <div class="profile-info-item">
                            <div class="profile-info-icon">
                                <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <div class="profile-info-content">
                                <span class="profile-info-label">Username</span>
                                <span class="profile-info-value" id="profileUsername">dokter</span>
                            </div>
                        </div>
                    </div>

                    <div class="profile-info-card">
                        <div class="profile-info-item">
                            <div class="profile-info-icon">
                                <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3zM3.31 9.397L5 10.12v4.102a8.969 8.969 0 00-1.05-.174 1 1 0 01-.89-.89 11.115 11.115 0 01.25-3.762zM9.3 16.573A9.026 9.026 0 007 14.935v-3.957l1.818.78a3 3 0 002.364 0l5.508-2.361a11.026 11.026 0 01.25 3.762 1 1 0 01-.89.89 8.968 8.968 0 00-5.35 2.524 1 1 0 01-1.4 0zM6 18a1 1 0 001-1v-2.065a8.935 8.935 0 00-2-.712V17a1 1 0 001 1z"/>
                                </svg>
                            </div>
                            <div class="profile-info-content">
                                <span class="profile-info-label">Specialization</span>
                                <span class="profile-info-value" id="profileSpecialization">Neurology</span>
                            </div>
                        </div>
                    </div>

                    <div class="profile-info-card">
                        <div class="profile-info-item">
                            <div class="profile-info-icon">
                                <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm5 6a1 1 0 10-2 0v3.586l-1.293-1.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V8z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <div class="profile-info-content">
                                <span class="profile-info-label">License ID</span>
                                <span class="profile-info-value" id="profileLicense">MD-123456</span>
                            </div>
                        </div>
                    </div>

                    <div class="profile-info-card">
                        <div class="profile-info-item">
                            <div class="profile-info-icon">
                                <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a1 1 0 110 2h-3a1 1 0 01-1-1v-2a1 1 0 00-1-1H9a1 1 0 00-1 1v2a1 1 0 01-1 1H4a1 1 0 110-2V4zm3 1h2v2H7V5zm2 4H7v2h2V9zm2-4h2v2h-2V5zm2 4h-2v2h2V9z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <div class="profile-info-content">
                                <span class="profile-info-label">Hospital Affiliation</span>
                                <span class="profile-info-value" id="profileHospital">General Hospital</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Account Activity -->
                <div class="profile-info-section">
                    <h4 class="profile-section-title">Account Activity</h4>
                    
                    <div class="profile-info-card">
                        <div class="profile-info-item">
                            <div class="profile-info-icon">
                                <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <div class="profile-info-content">
                                <span class="profile-info-label">Last Login</span>
                                <span class="profile-info-value" id="profileLastLogin">Just now</span>
                            </div>
                        </div>
                    </div>

                    <div class="profile-info-card">
                        <div class="profile-info-item">
                            <div class="profile-info-icon">
                                <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <div class="profile-info-content">
                                <span class="profile-info-label">Member Since</span>
                                <span class="profile-info-value" id="profileCreatedAt">December 2025</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Logout Button -->
                <div class="profile-actions">
                    <button class="btn-logout" onclick="handleLogout()">
                        <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z" clip-rule="evenodd"/>
                        </svg>
                        <span>Log Out</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="dashboard-main">
        <div class="dashboard-container">
            <!-- Dashboard Section -->
            <div id="dashboardSection" class="content-section">
                <h1>Doctor Dashboard</h1>
                <p>Manage your patients and track rehabilitation progress.</p>
            </div>
            
            <!-- Messages Section -->
            <div id="messagesSection" class="content-section" style="display: none;">
                <div class="messages-page">
                    <h1 class="messages-page__title">Messages</h1>
                    
                    <div class="messages-layout">
                        <!-- Left Panel: Chatbox (66.66%) -->
                        <div class="chat-panel" id="chatPanel">
                            <!-- Chat Header -->
                            <div class="chat-header" id="chatHeader">
                                <div class="chat-header__placeholder">
                                    <svg width="48" height="48" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"/>
                                    </svg>
                                    <p>Select a conversation to start messaging</p>
                                </div>
                                <div class="chat-header__active" style="display: none;">
                                    <div class="chat-header__user">
                                        <div class="chat-avatar" id="chatAvatar">
                                            <span id="chatAvatarInitial">A</span>
                                        </div>
                                        <div class="chat-header__info">
                                            <div class="chat-header__name" id="chatName">Alice Tan</div>
                                            <div class="chat-header__status" id="chatStatus">Online</div>
                                        </div>
                                    </div>
                                    <div class="chat-header__actions">
                                        <button class="chat-action-btn" title="Video Call" aria-label="Start video call">
                                            <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z"/>
                                            </svg>
                                        </button>
                                        <button class="chat-action-btn" title="Voice Call" aria-label="Start voice call">
                                            <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
                                            </svg>
                                        </button>
                                        <button class="chat-action-btn" title="More Options" aria-label="More options">
                                            <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"/>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Messages Area -->
                            <div class="chat-messages" id="chatMessages" role="log" aria-live="polite" aria-atomic="false">
                                <!-- Messages will be inserted here -->
                            </div>
                            
                            <!-- Typing Indicator -->
                            <div class="typing-indicator" id="typingIndicator" style="display: none;">
                                <div class="typing-indicator__content">
                                    <div class="typing-dot"></div>
                                    <div class="typing-dot"></div>
                                    <div class="typing-dot"></div>
                                </div>
                                <span class="typing-indicator__text">typing...</span>
                            </div>
                            
                            <!-- Message Composer -->
                            <div class="chat-composer" id="chatComposer">
                                <button class="composer-btn" title="Attach File" aria-label="Attach file">
                                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M8 4a3 3 0 00-3 3v4a5 5 0 0010 0V7a1 1 0 112 0v4a7 7 0 11-14 0V7a5 5 0 0110 0v4a3 3 0 11-6 0V7a1 1 0 012 0v4a1 1 0 102 0V7a3 3 0 00-3-3z" clip-rule="evenodd"/>
                                    </svg>
                                </button>
                                <button class="composer-btn" title="Emoji" aria-label="Insert emoji">
                                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 100-2 1 1 0 000 2zm7-1a1 1 0 11-2 0 1 1 0 012 0zm-.464 5.535a1 1 0 10-1.415-1.414 3 3 0 01-4.242 0 1 1 0 00-1.415 1.414 5 5 0 007.072 0z" clip-rule="evenodd"/>
                                    </svg>
                                </button>
                                <textarea 
                                    class="composer-input" 
                                    id="messageInput" 
                                    placeholder="Type a message..." 
                                    rows="1"
                                    aria-label="Message input"
                                ></textarea>
                                <button class="composer-send" id="sendButton" aria-label="Send message">
                                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Right Panel: Participants List (33.33%) -->
                        <div class="participants-panel" id="participantsPanel">
                            <!-- Search Box -->
                            <div class="participants-search">
                                <svg class="search-icon" width="18" height="18" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"/>
                                </svg>
                                <input 
                                    type="text" 
                                    class="search-input" 
                                    id="participantSearch" 
                                    placeholder="Search conversations..."
                                    aria-label="Search conversations"
                                />
                            </div>
                            
                            <!-- Filter Tabs -->
                            <div class="participants-filter">
                                <button class="filter-tab active" data-filter="all" onclick="filterParticipants('all')">
                                    All
                                </button>
                                <button class="filter-tab" data-filter="patient" onclick="filterParticipants('patient')">
                                    Patients
                                </button>
                                <button class="filter-tab" data-filter="physio" onclick="filterParticipants('physio')">
                                    Physiotherapists
                                </button>
                            </div>
                            
                            <!-- Participants List -->
                            <div class="participants-list" id="participantsList" role="list">
                                <!-- Participants will be inserted here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- User Profile Section -->
            <div id="profileSection" class="content-section" style="display: none;">
                <div class="profile-page">
                    <h1 class="profile-page__title">User Profile</h1>
                    
                    <div class="profile-layout">
                        <!-- Left Column: Avatar & Basic Info -->
                        <div class="profile-left">
                            <div class="profile-card profile-card--main">
                                <div class="profile-avatar-section">
                                    <div class="profile-avatar" id="profilePageAvatar">
                                        <span id="profilePageInitial">D</span>
                                    </div>
                                    <div class="profile-status-badge">
                                        <span class="status-dot"></span>
                                        <span class="status-text">Active</span>
                                    </div>
                                </div>
                                
                                <div class="profile-basic-info">
                                    <h2 class="profile-name" id="profilePageName">Dr. Dokter</h2>
                                    <p class="profile-role" id="profilePageRole">Doctor - Neurology</p>
                                    <p class="profile-id" id="profilePageId">ID: MD-123456</p>
                                </div>
                                
                                <div class="profile-stats">
                                    <div class="stat-item">
                                        <div class="stat-value" id="profilePagePatients">127</div>
                                        <div class="stat-label">Patients</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value" id="profilePageExperience">8+</div>
                                        <div class="stat-label">Years Exp.</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value" id="profilePageRating">4.9</div>
                                        <div class="stat-label">Rating</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Right Column: Detailed Information -->
                        <div class="profile-right">
                            <!-- Contact Information Card -->
                            <div class="profile-card">
                                <div class="profile-card__header">
                                    <h3 class="profile-card__title">
                                        <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
                                            <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
                                        </svg>
                                        Contact Information
                                    </h3>
                                </div>
                                <div class="profile-card__body">
                                    <div class="info-row">
                                        <span class="info-label">Email Address</span>
                                        <span class="info-value" id="profilePageEmail">dokter@neurotrack.com</span>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-label">Phone Number</span>
                                        <span class="info-value" id="profilePagePhone">+62 812-3456-7890</span>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-label">Mobile Number</span>
                                        <span class="info-value" id="profilePageMobile">+62 856-9876-5432</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Professional Information Card -->
                            <div class="profile-card">
                                <div class="profile-card__header">
                                    <h3 class="profile-card__title">
                                        <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3zM3.31 9.397L5 10.12v4.102a8.969 8.969 0 00-1.05-.174 1 1 0 01-.89-.89 11.115 11.115 0 01.25-3.762zM9.3 16.573A9.026 9.026 0 007 14.935v-3.957l1.818.78a3 3 0 002.364 0l5.508-2.361a11.026 11.026 0 01.25 3.762 1 1 0 01-.89.89 8.968 8.968 0 00-5.35 2.524 1 1 0 01-1.4 0zM6 18a1 1 0 001-1v-2.065a8.935 8.935 0 00-2-.712V17a1 1 0 001 1z"/>
                                        </svg>
                                        Professional Details
                                    </h3>
                                </div>
                                <div class="profile-card__body">
                                    <div class="info-row">
                                        <span class="info-label">License ID</span>
                                        <span class="info-value" id="profilePageLicense">MD-123456</span>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-label">Specialization</span>
                                        <span class="info-value" id="profilePageSpecialization">Neurology</span>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-label">Hospital Affiliation</span>
                                        <span class="info-value" id="profilePageHospital">General Hospital</span>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-label">Department</span>
                                        <span class="info-value" id="profilePageDepartment">Neuroscience Center</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Location & Address Card -->
                            <div class="profile-card">
                                <div class="profile-card__header">
                                    <h3 class="profile-card__title">
                                        <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
                                        </svg>
                                        Location & Address
                                    </h3>
                                </div>
                                <div class="profile-card__body">
                                    <div class="info-row">
                                        <span class="info-label">Practice Address</span>
                                        <span class="info-value" id="profilePageAddress">123 Medical Plaza, Jl. Kesehatan No. 45<br>Jakarta Selatan, DKI Jakarta 12345</span>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-label">City</span>
                                        <span class="info-value" id="profilePageCity">Jakarta</span>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-label">Country</span>
                                        <span class="info-value" id="profilePageCountry">Indonesia</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Account Information Card -->
                            <div class="profile-card">
                                <div class="profile-card__header">
                                    <h3 class="profile-card__title">
                                        <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                                        </svg>
                                        Account Information
                                    </h3>
                                </div>
                                <div class="profile-card__body">
                                    <div class="info-row">
                                        <span class="info-label">Username</span>
                                        <span class="info-value" id="profilePageUsername">dokter</span>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-label">Account Type</span>
                                        <span class="info-value">Professional - Doctor</span>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-label">Member Since</span>
                                        <span class="info-value" id="profilePageMemberSince">December 2025</span>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-label">Last Login</span>
                                        <span class="info-value" id="profilePageLastLogin">Just now</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Schedule Section -->
            <div id="scheduleSection" class="content-section" style="display: none;">
                <h1>Schedule</h1>
                <p>Manage your appointments and track your calendar.</p>
                
                <!-- Calendar Schedule Section -->
                <div class="schedule-section">
                    <div class="schedule-container">
                        <div class="schedule-layout">
                            <!-- Left Sidebar -->
                            <div class="calendar-sidebar-left">
                                <!-- Mini Calendar -->
                                <div class="mini-calendar">
                                    <div class="mini-calendar__header">
                                        <button class="mini-nav" onclick="miniPrevMonth(); return false;" aria-label="Previous month">
                                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"/>
                                            </svg>
                                        </button>
                                        <span class="mini-calendar__title" id="miniCalendarTitle">Feb 2024</span>
                                        <button class="mini-nav" onclick="miniNextMonth(); return false;" aria-label="Next month">
                                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                                            </svg>
                                        </button>
                                    </div>
                                    <div class="mini-calendar__grid" id="miniCalendarGrid">
                                        <!-- Mini calendar will be generated by JavaScript -->
                                    </div>
                                </div>
                                
                                <!-- Event Filters -->
                                <div class="event-filters">
                                    <h3 class="event-filters__title">Your sessions</h3>
                                    <label class="filter-checkbox">
                                        <input type="checkbox" checked onchange="filterEvents('practice')">
                                        <span class="filter-color practice"></span>
                                        <span class="filter-label">Practice</span>
                                    </label>
                                    <label class="filter-checkbox">
                                        <input type="checkbox" checked onchange="filterEvents('meeting')">
                                        <span class="filter-color meeting"></span>
                                        <span class="filter-label">Meeting</span>
                                    </label>
                                    <label class="filter-checkbox">
                                        <input type="checkbox" checked onchange="filterEvents('consultation')">
                                        <span class="filter-color consultation"></span>
                                        <span class="filter-label">Consultation</span>
                                    </label>
                                    <label class="filter-checkbox">
                                        <input type="checkbox" checked onchange="filterEvents('research')">
                                        <span class="filter-color research"></span>
                                        <span class="filter-label">Research</span>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- Main Calendar Area -->
                            <div class="calendar-main">
                        <!-- Calendar Controls -->
                        <div class="calendar-controls">
                            <div class="calendar-controls__left">
                                <h2 class="calendar-title" id="calendarTitle">February 2024</h2>
                                <button class="btn-today" onclick="goToToday()">This month</button>
                            </div>
                            <div class="calendar-controls__right">
                                <button class="btn-nav" onclick="previousMonth()" aria-label="Previous month">
                                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"/>
                                    </svg>
                                </button>
                                <button class="btn-nav" onclick="nextMonth()" aria-label="Next month">
                                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                                    </svg>
                                </button>
                                <select class="view-selector" onchange="changeView(this.value)">
                                    <option value="month">Month view</option>
                                    <option value="week">Week view</option>
                                    <option value="day">Day view</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Calendar Grid -->
                        <div class="calendar-grid">
                            <div class="calendar-header">
                                <div class="calendar-header__day">Mon</div>
                                <div class="calendar-header__day">Tue</div>
                                <div class="calendar-header__day">Wed</div>
                                <div class="calendar-header__day">Thu</div>
                                <div class="calendar-header__day">Fri</div>
                                <div class="calendar-header__day">Sat</div>
                                <div class="calendar-header__day">Sun</div>
                            </div>
                            <div class="calendar-body" id="calendarBody">
                                <!-- Calendar cells will be generated by JavaScript -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right Sidebar - Upcoming Events -->
                    <div class="calendar-sidebar-right">
                        <div class="upcoming-events">
                            <h3 class="upcoming-events__title">list of upcoming events</h3>
                            <div class="upcoming-events__list" id="upcomingEventsList">
                                <!-- Upcoming events will be generated by JavaScript -->
                            </div>
                        </div>
                    </div>
                        </div>
                    </div>
                </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Doctor-specific notifications (loaded from JSON in production)
        const doctorNotifications = [
            { icon: 'warning', title: 'Critical Patient Alert', description: 'Patient John Doe (ID: 12345) requires immediate attention. Vitals show concerning trend', time: '2 min ago', unread: true },
            { icon: 'info', title: 'New Patient Assignment', description: 'You have been assigned a new patient: Sarah Williams. Review case file in your dashboard', time: '15 min ago', unread: true },
            { icon: 'success', title: 'Lab Results Ready', description: 'Laboratory results for patient Michael Brown are now available for review', time: '45 min ago', unread: true },
            { icon: 'info', title: 'Meeting Reminder', description: 'Multidisciplinary team meeting scheduled for today at 2:00 PM in Conference Room B', time: '1 hour ago', unread: true },
            { icon: 'warning', title: 'Prescription Renewal', description: 'Prescription for patient Emma Davis expires in 3 days. Please review and renew if necessary', time: '2 hours ago', unread: true },
            { icon: 'success', title: 'Patient Progress Report', description: 'Patient David Thompson has shown 40% improvement in mobility assessments this month', time: '4 hours ago', unread: true },
            { icon: 'info', title: 'Consultation Request', description: 'Dr. Anderson requests your consultation on a complex neurology case for patient review', time: 'Yesterday', unread: false },
            { icon: 'info', title: 'New Research Study', description: 'New clinical trial on post-stroke rehabilitation methods now accepting patient enrollment', time: 'Yesterday', unread: false },
            { icon: 'success', title: 'Patient Discharge Approval', description: 'Patient Lisa Martinez has been approved for discharge. Discharge summary completed', time: '2 days ago', unread: false },
            { icon: 'info', title: 'System Update', description: 'Electronic Health Records system will undergo scheduled maintenance this weekend', time: '3 days ago', unread: false }
        ];
        
        // Calendar events data (loaded from JSON in production)
        const calendarEvents = [
            { id: 'evt_001', title: 'Morning Rounds', description: 'Daily patient rounds - Ward 3A', category: 'practice', date: '2025-12-13', time: '08:00', icon: 'ðŸ¥' },
            { id: 'evt_002', title: 'Patient Consultation', description: 'Follow-up consultation with John Doe', category: 'consultation', date: '2025-12-13', time: '10:30', icon: 'ðŸ’¬' },
            { id: 'evt_003', title: 'Team Meeting', description: 'Multidisciplinary team meeting', category: 'meeting', date: '2025-12-13', time: '14:00', icon: 'ðŸ‘¥' },
            { id: 'evt_004', title: 'Research Review', description: 'Clinical trial data analysis', category: 'research', date: '2025-12-13', time: '16:00', icon: 'ðŸ”¬' },
            { id: 'evt_005', title: 'Emergency Consultation', description: 'Urgent patient consultation', category: 'consultation', date: '2025-12-14', time: '09:00', icon: 'ðŸ’¬' },
            { id: 'evt_006', title: 'Department Meeting', description: 'Neurology department monthly meeting', category: 'meeting', date: '2025-12-14', time: '11:00', icon: 'ðŸ‘¥' },
            { id: 'evt_007', title: 'Clinical Practice', description: 'Outpatient clinic', category: 'practice', date: '2025-12-14', time: '13:00', icon: 'ðŸ¥' },
            { id: 'evt_008', title: 'Lab Results Review', description: 'Review laboratory results', category: 'consultation', date: '2025-12-15', time: '10:00', icon: 'ðŸ’¬' },
            { id: 'evt_009', title: 'Research Presentation', description: 'Present findings on rehabilitation', category: 'research', date: '2025-12-15', time: '14:00', icon: 'ðŸ”¬' },
            { id: 'evt_010', title: 'Patient Follow-up', description: 'Follow-up with David Thompson', category: 'consultation', date: '2025-12-16', time: '09:30', icon: 'ðŸ’¬' },
            { id: 'evt_011', title: 'Staff Meeting', description: 'Weekly staff coordination', category: 'meeting', date: '2025-12-16', time: '15:00', icon: 'ðŸ‘¥' },
            { id: 'evt_012', title: 'Morning Practice', description: 'New patient consultations', category: 'practice', date: '2025-12-17', time: '08:00', icon: 'ðŸ¥' },
            { id: 'evt_013', title: 'Research Workshop', description: 'Latest neurological research', category: 'research', date: '2025-12-17', time: '13:00', icon: 'ðŸ”¬' },
            { id: 'evt_014', title: 'Case Consultation', description: 'Complex case discussion', category: 'consultation', date: '2025-12-18', time: '10:00', icon: 'ðŸ’¬' },
            { id: 'evt_015', title: 'Board Meeting', description: 'Hospital board meeting', category: 'meeting', date: '2025-12-18', time: '14:00', icon: 'ðŸ‘¥' },
            { id: 'evt_016', title: 'Afternoon Clinic', description: 'Outpatient consultations', category: 'practice', date: '2025-12-19', time: '13:00', icon: 'ðŸ¥' },
            { id: 'evt_017', title: 'Patient Consultation', description: 'Initial consultation with Emma Davis', category: 'consultation', date: '2025-12-20', time: '09:00', icon: 'ðŸ’¬' },
            { id: 'evt_018', title: 'Research Meeting', description: 'Clinical trial progress meeting', category: 'research', date: '2025-12-20', time: '11:00', icon: 'ðŸ”¬' },
            { id: 'evt_019', title: 'Department Rounds', description: 'Weekly department rounds', category: 'practice', date: '2025-12-23', time: '08:00', icon: 'ðŸ¥' },
            { id: 'evt_020', title: 'Year-End Review', description: 'Annual performance meeting', category: 'meeting', date: '2025-12-27', time: '10:00', icon: 'ðŸ‘¥' }
        ];

        // Calendar state - single shared date for both calendars
        let currentDate = new Date(2025, 11, 13); // December 13, 2025
        let activeFilters = ['practice', 'meeting', 'consultation', 'research'];
        let activeSection = 'dashboard';
        
        // Show/hide sections
        function showSection(section) {
            // Hide all sections
            document.getElementById('dashboardSection').style.display = 'none';
            document.getElementById('scheduleSection').style.display = 'none';
            document.getElementById('profileSection').style.display = 'none';
            if (document.getElementById('messagesSection')) {
                document.getElementById('messagesSection').style.display = 'none';
            }
            
            // Show the selected section
            if (section === 'dashboard') {
                document.getElementById('dashboardSection').style.display = 'block';
            } else if (section === 'schedule') {
                document.getElementById('scheduleSection').style.display = 'block';
            } else if (section === 'profile') {
                document.getElementById('profileSection').style.display = 'block';
                loadProfilePage();
            } else if (section === 'messages') {
                document.getElementById('messagesSection').style.display = 'block';
                if (!window.chatInitialized) {
                    initializeChat();
                    window.chatInitialized = true;
                }
            }
            
            // Update active nav link
            document.querySelectorAll('.header-nav__link').forEach(link => {
                link.classList.remove('active');
            });
            if (event && event.target) {
                event.target.classList.add('active');
            }
            
            activeSection = section;
            
            // Render calendar if showing schedule
            if (section === 'schedule') {
                renderCalendar();
            }
        }

        // Toggle notification dropdown
        function toggleNotifications() {
            const dropdown = document.getElementById('notificationDropdown');
            const button = document.querySelector('.header-notification');
            dropdown.classList.toggle('active');
            button.classList.toggle('active');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            const dropdown = document.getElementById('notificationDropdown');
            const button = document.querySelector('.header-notification');
            if (dropdown && !dropdown.contains(e.target) && !button.contains(e.target)) {
                dropdown.classList.remove('active');
                button.classList.remove('active');
            }
        });

        // Load notifications
        function loadNotifications() {
            const listContainer = document.getElementById('notificationList');
            listContainer.innerHTML = doctorNotifications.map(notif => `
                <div class="notification-item ${notif.unread ? 'unread' : ''}">
                    <div class="notification-item__icon ${notif.icon}">
                        ${notif.icon === 'info' ? 'â„¹ï¸' : notif.icon === 'success' ? 'âœ…' : notif.icon === 'warning' ? 'âš ï¸' : 'ðŸ””'}
                    </div>
                    <div class="notification-item__content">
                        <div class="notification-item__title">${notif.title}</div>
                        <div class="notification-item__description">${notif.description}</div>
                        <div class="notification-item__time">${notif.time}</div>
                    </div>
                </div>
            `).join('');
            
            // Update notification count
            const unreadCount = doctorNotifications.filter(n => n.unread).length;
            document.querySelector('.notification-dropdown__count').textContent = unreadCount;
        }

        // Calendar Functions
        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            // Update calendar title
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                              'July', 'August', 'September', 'October', 'November', 'December'];
            document.getElementById('calendarTitle').textContent = `${monthNames[month]} ${year}`;
            
            // Get first day of month and number of days
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay() === 0 ? 6 : firstDay.getDay() - 1; // Adjust for Monday start
            
            // Get previous month's last days
            const prevMonthLastDay = new Date(year, month, 0).getDate();
            
            const calendarBody = document.getElementById('calendarBody');
            calendarBody.innerHTML = '';
            
            let dayCounter = 1;
            let nextMonthCounter = 1;
            const totalCells = 42; // 6 rows x 7 days
            
            for (let i = 0; i < totalCells; i++) {
                const cell = document.createElement('div');
                cell.className = 'calendar-cell';
                
                if (i < startingDayOfWeek) {
                    // Previous month days
                    const day = prevMonthLastDay - startingDayOfWeek + i + 1;
                    cell.classList.add('other-month');
                    cell.innerHTML = `<div class="cell-date">${day}</div>`;
                } else if (dayCounter <= daysInMonth) {
                    // Current month days
                    const cellDate = `${year}-${String(month + 1).padStart(2, '0')}-${String(dayCounter).padStart(2, '0')}`;
                    const today = new Date();
                    
                    if (dayCounter === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                        cell.classList.add('today');
                    }
                    
                    cell.innerHTML = `<div class="cell-date">${dayCounter}</div>`;
                    
                    // Add events for this day
                    const dayEvents = calendarEvents.filter(evt => 
                        evt.date === cellDate && activeFilters.includes(evt.category)
                    );
                    
                    if (dayEvents.length > 0) {
                        const eventsContainer = document.createElement('div');
                        eventsContainer.className = 'cell-events';
                        
                        dayEvents.forEach(evt => {
                            const eventEl = document.createElement('div');
                            eventEl.className = `cell-event ${evt.category}`;
                            eventEl.innerHTML = `
                                <span class="event-icon">${evt.icon}</span>
                                <span class="event-title">${evt.title}</span>
                            `;
                            eventsContainer.appendChild(eventEl);
                        });
                        
                        cell.appendChild(eventsContainer);
                    }
                    
                    dayCounter++;
                } else {
                    // Next month days
                    cell.classList.add('other-month');
                    cell.innerHTML = `<div class="cell-date">${nextMonthCounter}</div>`;
                    nextMonthCounter++;
                }
                
                calendarBody.appendChild(cell);
            }
            
            // Update mini calendar
            renderMiniCalendar();
            
            // Update upcoming events
            renderUpcomingEvents();
        }

        function renderMiniCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            // Update mini calendar title
            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 
                              'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            document.getElementById('miniCalendarTitle').textContent = `${monthNames[month]} ${year}`;
            
            const firstDay = new Date(year, month, 1);
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const startingDay = firstDay.getDay() === 0 ? 6 : firstDay.getDay() - 1;
            
            const grid = document.getElementById('miniCalendarGrid');
            grid.innerHTML = `
                <div class="mini-day-header">M</div>
                <div class="mini-day-header">T</div>
                <div class="mini-day-header">W</div>
                <div class="mini-day-header">T</div>
                <div class="mini-day-header">F</div>
                <div class="mini-day-header">S</div>
                <div class="mini-day-header">S</div>
            `;
            
            // Add empty cells for alignment
            for (let i = 0; i < startingDay; i++) {
                const cell = document.createElement('div');
                cell.className = 'mini-day empty';
                grid.appendChild(cell);
            }
            
            // Add days
            for (let day = 1; day <= daysInMonth; day++) {
                const cell = document.createElement('div');
                cell.className = 'mini-day';
                const cellDate = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                
                // Check if this day has events
                const hasEvents = calendarEvents.some(evt => evt.date === cellDate);
                if (hasEvents) {
                    cell.classList.add('has-events');
                }
                
                // Check if today
                const today = new Date();
                if (day === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                    cell.classList.add('today');
                }
                
                cell.textContent = day;
                grid.appendChild(cell);
            }
        }

        function renderUpcomingEvents() {
            const today = new Date();
            const upcomingEvents = calendarEvents
                .filter(evt => {
                    const eventDate = new Date(evt.date);
                    return eventDate >= today && activeFilters.includes(evt.category);
                })
                .sort((a, b) => {
                    const dateA = new Date(a.date + 'T' + a.time);
                    const dateB = new Date(b.date + 'T' + b.time);
                    return dateA - dateB;
                })
                .slice(0, 10); // Show next 10 events
            
            const container = document.getElementById('upcomingEventsList');
            container.innerHTML = upcomingEvents.map(evt => {
                const eventDate = new Date(evt.date);
                const dateStr = eventDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                
                return `
                    <div class="upcoming-event">
                        <div class="upcoming-event__icon ${evt.category}">${evt.icon}</div>
                        <div class="upcoming-event__content">
                            <div class="upcoming-event__title">${evt.title}</div>
                            <div class="upcoming-event__description">${evt.description}</div>
                            <div class="upcoming-event__time">${dateStr} â€¢ ${evt.time}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        }

        function goToToday() {
            currentDate = new Date(2025, 11, 13);
            renderCalendar();
        }

        function miniPrevMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar(); // This will update both calendars
        }

        function miniNextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar(); // This will update both calendars
        }

        function changeView(view) {
            console.log('View changed to:', view);
            // Placeholder for view change functionality
        }

        function filterEvents(category) {
            const index = activeFilters.indexOf(category);
            if (index > -1) {
                activeFilters.splice(index, 1);
            } else {
                activeFilters.push(category);
            }
            renderCalendar();
        }

        function loadProfilePage() {
            const userData = JSON.parse(localStorage.getItem('neurotrack_user') || '{}');
            
            if (userData && userData.profile) {
                // Basic Info
                document.getElementById('profilePageName').textContent = userData.profile.fullName || 'Dr. Dokter';
                document.getElementById('profilePageRole').textContent = 
                    `Doctor - ${(userData.profile.specialization || 'neurology').charAt(0).toUpperCase() + 
                    (userData.profile.specialization || 'neurology').slice(1)}`;
                document.getElementById('profilePageId').textContent = 
                    `ID: ${userData.profile.licenseId || 'MD-123456'}`;
                
                // Avatar Initial
                const firstLetter = (userData.profile.fullName || 'D').charAt(0).toUpperCase();
                document.getElementById('profilePageInitial').textContent = firstLetter;
                
                // Contact Information
                document.getElementById('profilePageEmail').textContent = userData.email || 'dokter@neurotrack.com';
                
                // Professional Details
                document.getElementById('profilePageLicense').textContent = userData.profile.licenseId || 'MD-123456';
                document.getElementById('profilePageSpecialization').textContent = 
                    (userData.profile.specialization || 'neurology').charAt(0).toUpperCase() + 
                    (userData.profile.specialization || 'neurology').slice(1);
                document.getElementById('profilePageHospital').textContent = 
                    userData.profile.hospitalAffiliation || 'General Hospital';
                
                // Account Information
                document.getElementById('profilePageUsername').textContent = userData.username || 'dokter';
                
                if (userData.created_at) {
                    const createdAt = new Date(userData.created_at);
                    document.getElementById('profilePageMemberSince').textContent = 
                        createdAt.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                }
                
                if (userData.last_login) {
                    const lastLogin = new Date(userData.last_login);
                    const now = new Date();
                    const diffMs = now - lastLogin;
                    const diffMins = Math.floor(diffMs / 60000);
                    
                    let lastLoginText;
                    if (diffMins < 1) {
                        lastLoginText = 'Just now';
                    } else if (diffMins < 60) {
                        lastLoginText = `${diffMins} minute${diffMins > 1 ? 's' : ''} ago`;
                    } else if (diffMins < 1440) {
                        const hours = Math.floor(diffMins / 60);
                        lastLoginText = `${hours} hour${hours > 1 ? 's' : ''} ago`;
                    } else {
                        lastLoginText = lastLogin.toLocaleDateString('en-US', { 
                            month: 'short', 
                            day: 'numeric', 
                            year: 'numeric' 
                        });
                    }
                    document.getElementById('profilePageLastLogin').textContent = lastLoginText;
                }
            }
        }

        // Load user data from localStorage
        window.addEventListener('DOMContentLoaded', () => {
            const userData = JSON.parse(localStorage.getItem('neurotrack_user') || '{}');
            
            if (!userData.role || userData.role !== 'doctor') {
                // Redirect to login if not authenticated or wrong role
                window.location.href = './login.html';
                return;
            }
            
            // Update header with user data
            document.getElementById('userName').textContent = userData.profile?.fullName || 'Dr. Dokter';
            document.getElementById('userRole').textContent = 'Doctor';
            
            // Update avatar with first letter of name
            const firstLetter = (userData.profile?.fullName || 'D').charAt(0).toUpperCase();
            document.getElementById('userAvatar').textContent = firstLetter;
            
            // Load notifications
            loadNotifications();
            
            // Show dashboard by default
            showSection('dashboard');
        });

        function toggleUserMenu() {
            openProfileModal();
        }

        function openProfileModal() {
            const modal = document.getElementById('profileModal');
            const userData = JSON.parse(localStorage.getItem('neurotrack_user') || '{}');
            
            // Populate profile data
            if (userData && userData.profile) {
                // Basic Info
                document.getElementById('profileName').textContent = userData.profile.fullName || 'Dr. Dokter';
                document.getElementById('profileRoleBadge').textContent = 'Doctor';
                document.getElementById('profileEmail').textContent = userData.email || 'dokter@neurotrack.com';
                document.getElementById('profileUsername').textContent = userData.username || 'dokter';
                
                // Professional Info
                document.getElementById('profileSpecialization').textContent = 
                    (userData.profile.specialization || 'neurology').charAt(0).toUpperCase() + 
                    (userData.profile.specialization || 'neurology').slice(1);
                document.getElementById('profileLicense').textContent = userData.profile.licenseId || 'MD-123456';
                document.getElementById('profileHospital').textContent = userData.profile.hospitalAffiliation || 'General Hospital';
                
                // Activity Info
                if (userData.last_login) {
                    const lastLogin = new Date(userData.last_login);
                    const now = new Date();
                    const diffMs = now - lastLogin;
                    const diffMins = Math.floor(diffMs / 60000);
                    
                    let lastLoginText;
                    if (diffMins < 1) {
                        lastLoginText = 'Just now';
                    } else if (diffMins < 60) {
                        lastLoginText = `${diffMins} minute${diffMins > 1 ? 's' : ''} ago`;
                    } else if (diffMins < 1440) {
                        const hours = Math.floor(diffMins / 60);
                        lastLoginText = `${hours} hour${hours > 1 ? 's' : ''} ago`;
                    } else {
                        lastLoginText = lastLogin.toLocaleDateString('en-US', { 
                            month: 'short', 
                            day: 'numeric', 
                            year: 'numeric' 
                        });
                    }
                    document.getElementById('profileLastLogin').textContent = lastLoginText;
                }
                
                if (userData.created_at) {
                    const createdAt = new Date(userData.created_at);
                    document.getElementById('profileCreatedAt').textContent = 
                        createdAt.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                }
                
                // Profile Photo Initial
                const firstLetter = (userData.profile.fullName || 'D').charAt(0).toUpperCase();
                document.getElementById('profilePhotoInitial').textContent = firstLetter;
            }
            
            // Show modal with animation
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeProfileModal() {
            const modal = document.getElementById('profileModal');
            modal.classList.remove('active');
            document.body.style.overflow = '';
        }

        function handleLogout() {
            // Show confirmation dialog
            const confirmLogout = confirm('Are you sure you want to log out?');
            
            if (confirmLogout) {
                // Clear session data
                localStorage.removeItem('neurotrack_user');
                
                // Close modal
                closeProfileModal();
                
                // Redirect to login page
                setTimeout(() => {
                    window.location.href = './login.html';
                }, 200);
            }
        }

        // Close modal on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeProfileModal();
            }
        });

        // ==================== CHAT SYSTEM ====================
        let chatData = null;
        let activeChat = null;
        let currentFilter = 'all';

        async function initializeChat() {
            try {
                // Load chat data from JSON file
                const response = await fetch('../data/messages.json');
                chatData = await response.json();
                
                // Render participants list
                renderParticipants();
                
                // Setup search functionality
                setupSearch();
                
                // Setup message composer
                setupComposer();
                
                console.log('Chat initialized successfully');
            } catch (error) {
                console.error('Failed to initialize chat:', error);
            }
        }

        function renderParticipants(filterType = 'all') {
            if (!chatData || !chatData.participants) return;
            
            const participantsList = document.getElementById('participantsList');
            let participants = chatData.participants;
            
            // Apply filter
            if (filterType === 'patient') {
                participants = participants.filter(p => p.type === 'patient');
            } else if (filterType === 'physio') {
                participants = participants.filter(p => p.type === 'physio');
            }
            
            // Sort by last message time (most recent first)
            participants.sort((a, b) => new Date(b.lastMessageTime) - new Date(a.lastMessageTime));
            
            participantsList.innerHTML = participants.map(participant => `
                <div class="participant-item ${activeChat === participant.id ? 'active' : ''}" 
                     data-id="${participant.id}" 
                     onclick="selectParticipant('${participant.id}')"
                     role="listitem">
                    <div class="participant-avatar">
                        <span class="avatar-initial">${participant.name.charAt(0)}</span>
                        ${participant.online ? '<span class="online-dot"></span>' : ''}
                    </div>
                    <div class="participant-info">
                        <div class="participant-header">
                            <div class="participant-name">${participant.name}</div>
                            <div class="participant-time">${formatMessageTime(participant.lastMessageTime)}</div>
                        </div>
                        <div class="participant-preview">
                            <span class="preview-text">${participant.lastMessage}</span>
                            ${participant.unread > 0 ? `<span class="unread-badge">${participant.unread}</span>` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function selectParticipant(participantId) {
            activeChat = participantId;
            
            // Find participant data
            const participant = chatData.participants.find(p => p.id === participantId);
            if (!participant) return;
            
            // Clear unread count
            participant.unread = 0;
            
            // Update UI to show active chat
            document.querySelectorAll('.participant-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`.participant-item[data-id="${participantId}"]`)?.classList.add('active');
            
            // Show chat header
            document.querySelector('.chat-header__placeholder').style.display = 'none';
            document.querySelector('.chat-header__active').style.display = 'flex';
            
            // Update chat header
            document.getElementById('chatName').textContent = participant.name;
            document.getElementById('chatStatus').textContent = participant.online ? 'Online' : 'Offline';
            document.getElementById('chatAvatarInitial').textContent = participant.name.charAt(0);
            
            // Load and display messages
            loadMessages(participantId);
            
            // Re-render participants to update unread badge
            renderParticipants(currentFilter);
        }

        function loadMessages(participantId) {
            const messagesContainer = document.getElementById('chatMessages');
            const messages = chatData.messages[participantId] || [];
            
            if (messages.length === 0) {
                messagesContainer.innerHTML = '<div class="no-messages">No messages yet</div>';
                return;
            }
            
            messagesContainer.innerHTML = messages.map((message, index) => {
                const isMe = message.from === 'me';
                const showDate = index === 0 || !isSameDay(message.time, messages[index - 1].time);
                
                return `
                    ${showDate ? `<div class="message-date">${formatDate(message.time)}</div>` : ''}
                    <div class="message ${isMe ? 'message--sent' : 'message--received'}">
                        <div class="message-bubble">
                            <div class="message-text">${message.text}</div>
                            <div class="message-meta">
                                <span class="message-time">${formatTime(message.time)}</span>
                                ${isMe ? `
                                    <span class="message-status">
                                        ${message.read ? 
                                            '<svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/></svg><svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20" style="margin-left: -8px;"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/></svg>' 
                                            : '<svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/></svg>'}
                                    </span>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            // Scroll to bottom
            setTimeout(() => {
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }, 100);
        }

        function sendMessage() {
            if (!activeChat) return;
            
            const input = document.getElementById('messageInput');
            const messageText = input.value.trim();
            
            if (!messageText) return;
            
            // Create new message object
            const newMessage = {
                id: `m${Date.now()}`,
                from: 'me',
                to: activeChat,
                text: messageText,
                time: new Date().toISOString(),
                sent: true,
                read: false
            };
            
            // Add to messages array
            if (!chatData.messages[activeChat]) {
                chatData.messages[activeChat] = [];
            }
            chatData.messages[activeChat].push(newMessage);
            
            // Update participant's last message
            const participant = chatData.participants.find(p => p.id === activeChat);
            if (participant) {
                participant.lastMessage = messageText;
                participant.lastMessageTime = newMessage.time;
            }
            
            // Clear input
            input.value = '';
            input.style.height = 'auto';
            
            // Reload messages
            loadMessages(activeChat);
            
            // Re-render participants
            renderParticipants(currentFilter);
        }

        function setupComposer() {
            const input = document.getElementById('messageInput');
            const sendButton = document.getElementById('sendButton');
            
            // Auto-resize textarea
            input.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 120) + 'px';
            });
            
            // Send on Enter (Shift+Enter for new line)
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            // Send button click
            sendButton.addEventListener('click', sendMessage);
        }

        function setupSearch() {
            const searchInput = document.getElementById('participantSearch');
            
            searchInput.addEventListener('input', function() {
                const query = this.value.toLowerCase();
                const participants = document.querySelectorAll('.participant-item');
                
                participants.forEach(item => {
                    const name = item.querySelector('.participant-name').textContent.toLowerCase();
                    const preview = item.querySelector('.preview-text').textContent.toLowerCase();
                    
                    if (name.includes(query) || preview.includes(query)) {
                        item.style.display = 'flex';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });
            
            // Keyboard shortcut: / to focus search
            document.addEventListener('keydown', function(e) {
                if (e.key === '/' && document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA') {
                    e.preventDefault();
                    searchInput.focus();
                }
            });
        }

        function filterParticipants(type) {
            currentFilter = type;
            
            // Update filter tabs
            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`.filter-tab[data-filter="${type}"]`).classList.add('active');
            
            // Re-render participants
            renderParticipants(type);
        }

        // Utility functions
        function formatMessageTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            
            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m`;
            if (diffMins < 1440) return `${Math.floor(diffMins / 60)}h`;
            if (diffMins < 10080) return `${Math.floor(diffMins / 1440)}d`;
            
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }

        function formatTime(timestamp) {
            return new Date(timestamp).toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: true 
            });
        }

        function formatDate(timestamp) {
            const date = new Date(timestamp);
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            if (isSameDay(date, today)) return 'Today';
            if (isSameDay(date, yesterday)) return 'Yesterday';
            
            return date.toLocaleDateString('en-US', { 
                month: 'long', 
                day: 'numeric',
                year: date.getFullYear() !== today.getFullYear() ? 'numeric' : undefined
            });
        }

        function isSameDay(date1, date2) {
            const d1 = new Date(date1);
            const d2 = new Date(date2);
            return d1.getFullYear() === d2.getFullYear() &&
                   d1.getMonth() === d2.getMonth() &&
                   d1.getDate() === d2.getDate();
        }
    </script>
</body>
</html>
